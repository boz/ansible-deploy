---
- hosts: all
  roles:
    - common
    - rsyslog
  tags: ['provision']

- hosts: server_postgres
  roles:
    - postgres-server
  tags: ['provision']

- hosts: server_redis
  roles:
    - redis
  tags: ['provision']

- hosts: server_application
  roles:
    - app-base
    - supervisor
    - nginx-base
  tags: ['provision','app']

- hosts: server_application_nodejs
  roles:
    - app-nodejs-base
  tags: ['provision','app','nodejs']

- hosts: server_postgres
  roles:
    - postgres-server-host
  tags: ['provision','app']

- hosts: server_application_rails
  roles:
    - app-rails-base
  tags: ['provision','app','rails']

# nodeapp playbook
- hosts: nodeapp_app_servers
  roles:
    - app-checkout-pending
    - app-configure
    - app-nodejs-npm
    - app-nginx
    - app-checkout-finalize
    - app-nodejs-finalize
  tags: ['deploy','app','app-nodeapp']
  vars_files:
    - "vars/nodeapp.yml"

# railsapp playbook
- hosts: railsapp_app_servers
  roles:
    - app-checkout-pending
    - app-configure
    - app-rails-bundle
    - role: app-rails-rake
      commands:
        - "assets:precompile"
        - "db:migrate"
    - app-rails-unicorn
    - app-nginx
    - app-checkout-finalize
    - app-rails-finalize
  vars_files:
    - "vars/railsapp.yml"
